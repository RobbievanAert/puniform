{
    "contents" : "### Correlation coefficients between levels of habituation and measures of IQ\n### Obtained from Table 1 in McCall and Carriger (1993)\n\nrm(list = ls())\n\nlibrary(metafor)\n\n### In order to create plots\nx <- 20\ny <- 20\n\n### Raw correlation coefficients (all studies)\ncor.r <- c(.61, .43, .29, .55, .6, .54, .29, .46, .52, .4, .39, .39)\n\n### Raw correlation coefficients (significant studies)\n#cor.r <- c(.61, .29, .55, .6, .54, .29, .46, .52, .4, .39, .39)\n\n### Sample size per study (all studies)\nns <- c(11, 21, 91, 18, 28, 14, 96, 20, 22, 57, 29, 40)\n\n### Sample size per study (significant studies)\n#ns <- c(11, 91, 18, 28, 14, 96, 20, 22, 57, 29, 40)\n\n### Fisher's z transformation\ncor.z <- .5*log((1+cor.r)/(1-cor.r))\n\n### Variance of Fisher's z transformation\nv.z <- 1/(ns - 3)\n\n### Z-values for each study\nzs <- cor.z/sqrt(1/(ns - 3))\n\n### P-values for each single study\np.val <- 1 - pnorm(cor.z, mean = 0, sd = sqrt(v.z))\npobs <- 1 - pnorm(zs, 0, 1)\n\n### Funnel plot\nres <- rma(cor.z, v.z, method = \"FE\")\nfunnel(res, xlab = \"Fisher Transformed Correlations\", ylab = \"Inverse of Standard Error\")\n\n### Failsafe N\nfsn(cor.z, v.z, type = \"Rosenthal\")\n\n### Rank-correlation test\nranktest(res)\n\n### Egger's test\nregtest(res)\n\n### Trim-and-fill\ntest <- trimfill(res)\nfunnel(test)\nfunnel(test, level=c(90, 95, 99), shade=c(\"white\", \"gray\", \"darkgray\"), refline=0)\n\n### Create a dataframe\ndf <- data.frame(cor.z, v.z, ns, p.val)\np05 <- subset(df, p.val < .025)\np05\n\n### Exploratory test\nzcv <- qnorm(.975)*sqrt(df$v.z)\npow <- 1 - pnorm(zcv, res$b[1], sqrt(df$v.z))  \nexpec <- sum(pow)\nstatA <- (nrow(p05) - expec)^2/expec + (nrow(p05) - expec)^2/(nrow(df) - expec) \nstatA\nexplmu <- 1 - pchisq(statA, 1)\nexplmu\n\n### p-uniform: Effect schatten: LN(P)\npdist <- function(d) {\n  d <- .5*log((1 + d) / (1 - d))  ### Fisher's z transformation\n  pmarg <- 1 - pnorm(qnorm(.975)*sqrt(p05$v.z), d, sqrt(p05$v.z))\n  ph1 <- (1 - pnorm(p05$cor.z, d, sqrt(p05$v.z)))/pmarg\n  sum(-log(ph1))\n}\n\nestnw <- function(d, b) {\n  pdist(d) - b\n}\n\ntheta.lb <-  uniroot(estnw, c(-.1, 1), tol = .0001, b = qgamma(.975, nrow(p05), 1))\ntheta <-     uniroot(estnw, c(0, 1), tol = .0001, b = nrow(p05))\ntheta.ub <-  uniroot(estnw, c(0, 1), tol = .0001, b = qgamma(.025, nrow(p05), 1))\n\nest <- matrix(nrow = 1, ncol = 3, dimnames = list(\"\", c(\"95% LB\", \"Theta\", \"95% UB\")))\nest[1] <- theta.lb$root\nest[2] <- theta$root\nest[3] <- theta.ub$root\nest\n\n### p-uniform: Effect schatten: LN(1-P)\npdist <- function(d) {\n  d <- .5*log((1 + d) / (1 - d))  ### Fisher's z transformation\n  pmarg <- 1 - pnorm(qnorm(.975)*sqrt(p05$v.z), d, sqrt(p05$v.z))\n  ph1 <- (1 - pnorm(p05$cor.z, d, sqrt(p05$v.z)))/pmarg\n  sum(-log(1-ph1))\n}\n\nestnw <- function(d, b) {\n  pdist(d) - b\n}\n\ntheta.lb <-  uniroot(estnw, c(-.57, 1), tol = .0001, b = qgamma(.025, nrow(p05), 1))\ntheta <-     uniroot(estnw, c(0, 1), tol = .0001, b = nrow(p05))\ntheta.ub <-  uniroot(estnw, c(0, 1), tol = .0001, b = qgamma(.975, nrow(p05), 1))\n\nest <- matrix(nrow = 1, ncol = 3, dimnames = list(\"\", c(\"95% LB\", \"Theta\", \"95% UB\")))\nest[1] <- theta.lb$root\nest[2] <- theta$root\nest[3] <- theta.ub$root\nest\n\n### p-uniform: Publication bias test: LN(P)\n### IS NOT CORRECT: RES$B[1] IS ALREADY A FISHER-Z SCORE\npmarg <- 1 - pnorm(qnorm(.975)*sqrt(p05$v.z), 0.5*log((1+res$b[1])/(1-res$b[1])), sqrt(p05$v.z))\nph1 <- (1 - pnorm(p05$cor.z, 0.5*log((1+res$b[1])/(1-res$b[1])), sqrt(p05$v.z)))/pmarg\nstat <- sum(-log(ph1))\npval <- pgamma(stat, nrow(p05), 1)\npval\n\n### CORRECT:\npmarg <- 1 - pnorm(qnorm(.975)*sqrt(p05$v.z), res$b[1], sqrt(p05$v.z))\nph1 <- (1 - pnorm(p05$cor.z, res$b[1], sqrt(p05$v.z)))/pmarg\nstat <- sum(-log(ph1))\npval <- pgamma(stat, nrow(p05), 1)\npval\n\n\n### p-uniform: Publication bias test: LN(1-P)\nstat <- sum(-log(1-ph1))\npval <- 1 - pgamma(stat, nrow(p05), 1)\npval\n\n### p-uniform: Testen of effect significant van 0 afwijkt: LN(P)\npmarg <- 1 - pnorm(qnorm(.975)*sqrt(p05$v.z), 0.5*log((1+0)/(1-0)), sqrt(p05$v.z))\nph1 <- (1 - pnorm(p05$cor.z, 0.5*log((1+0)/(1-0)), sqrt(p05$v.z)))/pmarg\nstat <- sum(-log(ph1))\npval <- 2*(1 - pgamma(stat, nrow(p05), 1))\npval\n\n### p-uniform: Testen of effect significant van 0 afwijkt: LN(1-P)\nstat <- sum(-log(1-ph1))\npval <- 2*(pgamma(stat, nrow(p05), 1))\npval\n\n### Dit 3x doen ph1 van publication bias test, effect size, en effect schatten (effect, lower bound en upper bound)\nplot(x, y, xlim=c(0,1), ylim=c(0,1), yaxt = \"n\", bty = \"n\", ylab = \"\", xlab = expression(paste(Transformed~italic(p)-values)), cex.lab = 1.2, cex.axis = 1.2)\nabline(v=ph1)\n\n### Trim-and-fill\ntest <- trimfill(res)\nfunnel(test, xlab = \"Fisher Transformed Correlation\")\n\n### Contour-enhanced funnel plot\nres <- rma(cor.z, v.z, method = \"FE\")\nfunnel(res, level=c(90, 95, 99), shade=c(\"white\", \"gray\", \"darkgray\"), xlab = \"Fisher Transformed Correlation\", refline=0)",
    "created" : 1425397945570.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2331321722",
    "id" : "E1484ABE",
    "lastKnownWriteTime" : 1425373824,
    "path" : "D:/Dropbox/Werk/Onderzoek/Papers/Finished/Paper Marcel/Script Plot McCall.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}